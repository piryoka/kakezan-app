
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>苦手な掛け算（音声読み上げつき）</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, system-ui;
  text-align: center;
  padding: 16px;
  background: #f7f7fb;
}
.card {
  background: white;
  padding: 20px;
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  max-width: 380px;
  margin: auto;
}
.question {
  font-size: 2rem;
  margin-bottom: 16px;
}
.buttons {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
}
button.choice {
  padding: 10px 16px;
  border-radius: 12px;
  background: #4f46e5;
  color: white;
  font-size: 1.2rem;
  border: none;
  min-width: 70px;
}
#feedback {
  margin-top: 12px;
  min-height: 2.4rem;
  font-weight: bold;
}
#next-question {
  margin-top: 10px;
  padding: 8px 14px;
  background: #e5e7eb;
  border: none;
  border-radius: 8px;
}
.hint {
  margin-top: 10px;
  font-size: 0.8rem;
  color: #555;
}
</style>
</head>
<body>

<div class="card">
  <div id="question" class="question"></div>
  <div id="choices" class="buttons"></div>
  <div id="feedback"></div>
  <button id="next-question">つぎのもんだい</button>
  <div class="hint">
    （3×7 のときに「3x7.mp3」を再生します。<br>
    GitHubに音声ファイルを置くと、あなたの声で読み上げできます）
  </div>
</div>

<script>
// 問題リスト
var problems = [
  {a:3,b:7},{a:3,b:8},{a:3,b:9},{a:4,b:3},{a:2,b:7},{a:6,b:7},{a:6,b:4},
  {a:7,b:2},{a:7,b:3},{a:8,b:2},{a:8,b:3},{a:8,b:5},{a:8,b:6}
];

// よくまちがえる候補
var wrongPatterns = {
  "3x7":[24,28,56],
  "3x8":[29],
  "3x9":[24,26],
  "4x3":[14],
  "2x7":[18],
  "6x7":[28],
  "6x4":[32],
  "7x2":[12,18],
  "7x3":[28],
  "8x2":[12],
  "8x3":[21,27],
  "8x5":[30],
  "8x6":[36]
};

// 値ごとの説明
var wrongExplain = {
  12: "12になるのは、2×6と3×4だよ",
  14: "14になるのは、2×7だよ",
  16: "16になるのは、2×8と4×4だよ",
  18: "18になるのは、2×9と3×6だよ",
  21: "21になるのは、3×7だよ",
  24: "24になるのは、3×8と4×6だよ",
  26: "26になる九九はないよ",
  27: "27になるのは、3×9だよ",
  28: "28になるのは、4×7だよ",
  29: "29になる九九はないよ",
  30: "30になるのは、5×6だよ",
  32: "32になるのは、4×8だよ",
  36: "36になるのは、6×6だよ",
  56: "56になるのは、7×8だよ"
};

// ★ あなたの声の音声ファイル対応（同じフォルダに置く想定）
// 例：3×7のとき "3x7.mp3" を再生
var voiceFiles = {
  "3x7": "3x7.mp3",
  "3x8": "3x8.mp3",
  "3x9": "3x9.mp3",
  "4x3": "4x3.mp3",
  "2x7": "2x7.mp3",
  "6x7": "6x7.mp3",
  "6x4": "6x4.mp3",
  "7x2": "7x2.mp3",
  "7x3": "7x3.mp3",
  "8x2": "8x2.mp3",
  "8x3": "8x3.mp3",
  "8x5": "8x5.mp3",
  "8x6": "8x6.mp3"
};

var qEl = document.getElementById("question");
var cEl = document.getElementById("choices");
var fb  = document.getElementById("feedback");
var nextBtn = document.getElementById("next-question");

var current = null;

function key(p){ return p.a + "x" + p.b; }

function pickRandom(){
  current = problems[Math.floor(Math.random() * problems.length)];
}

function shuffle(array){
  for (let i = array.length - 1; i > 0; i--) {
    let j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function render(){
  fb.textContent = "";
  fb.style.color = "";
  qEl.textContent = current.a + " × " + current.b + " = ?";
  cEl.innerHTML = "";

  var result = current.a * current.b;
  var patterns = wrongPatterns[key(current)] || [];

  var set = {};
  set[result] = true;
  patterns.forEach(function(v){ set[v] = true; });

  var options = Object.keys(set).map(function(n){ return parseInt(n); });

  shuffle(options);

  options.forEach(function(v){
    var btn = document.createElement("button");
    btn.textContent = v;
    btn.className = "choice";
    btn.onclick = function(){ choose(v); };
    cEl.appendChild(btn);
  });
}

// 音：正解
function playCorrect(){
  var AC = window.AudioContext || window.webkitAudioContext;
  if (!AC) return;
  var ctx = new AC();
  var o = ctx.createOscillator(), g = ctx.createGain();
  o.type = "sine";
  o.frequency.setValueAtTime(880, ctx.currentTime);
  o.frequency.setValueAtTime(1320, ctx.currentTime + 0.1);
  g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.3);
  o.connect(g); g.connect(ctx.destination);
  o.start(); o.stop(ctx.currentTime + 0.3);
}

// 音：不正解
function playWrong(){
  var AC = window.AudioContext || window.webkitAudioContext;
  if (!AC) return;
  var ctx = new AC();
  var o = ctx.createOscillator(), g = ctx.createGain();
  o.type = "square";
  o.frequency.value = 200;
  g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.4);
  o.connect(g); g.connect(ctx.destination);
  o.start(); o.stop(ctx.currentTime + 0.4);
}

// ★ 問題スタート時に、対応する音声ファイルを再生
function playQuestionVoice(){
  var k = key(current);
  var src = voiceFiles[k];
  if (!src) return; // 音声ファイルが用意されていない場合は何もしない

  var audio = new Audio(src);
  // ユーザー操作（ボタン）から呼ばれるので再生許可されやすい
  audio.play().catch(function(e){
    // 再生できなくてもエラーは無視
    console.log("audio play error:", e);
  });
}

function choose(v){
  var result = current.a * current.b;

  if (v === result) {
    fb.textContent = "◯ 正解！";
    fb.style.color = "#15803d";
    playCorrect();

    // 正解したボタンだけ緑にする
    var buttons = document.querySelectorAll(".choice");
    buttons.forEach(function(btn){
      var val = parseInt(btn.textContent);
      if (val === result) {
        btn.style.background = "#16a34a";
      }
    });
  } else {
    var base = "× " + v + "じゃないよ。";
    var exp = wrongExplain[v];
    if (!exp) {
      exp = v + "になる九九はここにはないよ";
    }
    fb.textContent = base + " " + exp;
    fb.style.color = "#b91c1c";
    playWrong();
  }
}

nextBtn.onclick = function(){ next(); };

function next(){
  pickRandom();
  render();
  // 問題を表示したタイミングで、対応する音声を再生
  playQuestionVoice();
}

// 初回はボタンを押してから始めてね（自動再生対策）
next();
</script>

</body>
</html>
